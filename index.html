<script>
    let allApps = [];

    // 1. Carica i dati
    async function loadApps() {
        try {
            const response = await fetch('apps.json');
            if (!response.ok) throw new Error("File apps.json non trovato.");
            allApps = await response.json();
            renderApps(allApps);
        } catch (error) {
            document.getElementById('appGrid').innerHTML = `
                <div class="col-span-full text-center p-10 bg-red-50 text-red-600 rounded-xl">
                    ${error.message}
                </div>`;
        }
    }

    // 2. Funzione aggiornata con le chiavi corrette (nome, riassunto, etc.)
    function renderApps(apps) {
        const grid = document.getElementById('appGrid');
        if (apps.length === 0) {
            grid.innerHTML = '<p class="col-span-full text-center py-10 text-slate-500">Nessuna app trovata.</p>';
            return;
        }

        grid.innerHTML = apps.map(app => `
            <div class="bg-white p-5 rounded-2xl shadow-sm border border-slate-200 hover:shadow-md transition-all">
                <div class="flex items-center gap-4 mb-3">
                    <img src="${app.icona || 'https://via.placeholder.com/64'}" 
                         onerror="this.src='https://via.placeholder.com/64'"
                         class="w-12 h-12 rounded-xl bg-slate-100 object-cover">
                    <h2 class="font-bold text-lg text-slate-800">${app.nome || 'Senza Nome'}</h2>
                </div>
                <p class="text-slate-600 text-sm h-12 overflow-hidden">${app.riassunto || 'Nessuna descrizione disponibile'}</p>
                <div class="mt-4 flex items-center justify-between">
                    <span class="text-[10px] bg-indigo-50 px-2 py-1 rounded text-indigo-600 uppercase font-bold">${app.licenza || 'Open'}</span>
                    <a href="${app.url_codice_sorgente}" target="_blank" class="text-indigo-600 font-semibold text-sm hover:underline">Vedi Codice â†’</a>
                </div>
            </div>
        `).join('');
    }

    // 3. Logica di ricerca corretta
    document.getElementById('searchBar').addEventListener('input', (e) => {
        const term = e.target.value.toLowerCase();
        const filtered = allApps.filter(app => 
            (app.nome && app.nome.toLowerCase().includes(term)) || 
            (app.riassunto && app.riassunto.toLowerCase().includes(term))
        );
        renderApps(filtered);
    });

    loadApps();
</script>
